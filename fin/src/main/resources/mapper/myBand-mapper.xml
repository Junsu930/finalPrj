<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="myBandMapper">
	<resultMap type="myBand" id="bandBoard_rm">
		<id property="boardNo" column="BOARD_NO"/>
		<result property="boardTitle" column="BOARD_TITLE"/>		
		<result property="boardContent" column="BOARD_CONTENT"/>		
		<result property="boardDate" column="CREATE_DATE"/>		
		<result property="readCount" column="READ_COUNT"/>		
		<result property="userNick" column="USER_NICK"/>		
		<result property="boardLike" column="BOARD_LIKE"/>		
		<result property="boardTag" column="BOARD_TAG"/>		
		<result property="bandName" column="BAND_NAME"/>		
	</resultMap>
	
	<select id="bandBoardList" parameterType="hashmap" resultMap="bandBoard_rm">
		SELECT *
		FROM (SELECT ROWNUM RN ,A.* FROM (SELECT BOARD_NO ,BOARD_TITLE, BOARD_CONTENT , CASE WHEN SYSDATE - CREATE_DATE &lt; 1
		THEN TO_CHAR(CREATE_DATE, 'HH:MI')
		ELSE TO_CHAR(CREATE_DATE, 'YYYY-MM-DD')
		END CREATE_DATE, READ_COUNT , USER_NICK, BOARD_LIKE ,BOARD_TAG, BAND_NAME  
		FROM BAND_BOARD bb 
		JOIN "USER" USING(USER_NO) 
		JOIN BAND b USING(BAND_NO) 
		WHERE BAND_NO = ${bandNo} 
		AND BOARD_ST = 'Y' ORDER BY CREATE_DATE ASC) A) 
		WHERE RN &gt; (#{pageNum}-1) * #{amount} AND RN<![CDATA[<=]]> #{pageNum} * #{amount}
	</select>
	
	<select id="leaderNick" parameterType="_int" resultType="string">
		SELECT USER_NICK FROM BAND_USER bu JOIN "USER" u USING(USER_NO) WHERE BAND_NO = 1 AND LEADER_FL = 'T'
	</select>
	
	<select id="bandMember" parameterType="_int" resultType="string">
		SELECT USER_NICK FROM BAND_USER bu JOIN "USER" u USING(USER_NO) WHERE BAND_NO = 1 AND LEADER_FL = 'F'
	</select>
	
	<select id="getTotal" parameterType="_int" resultType="_int">
		SELECT COUNT(*) FROM BAND_BOARD bb WHERE BAND_NO = ${bandNo}
	</select>
	
	<select id="bandUserFl" parameterType="hashmap" resultType="_int">
		SELECT COUNT(*) FROM BAND_USER WHERE BAND_NO  = ${bandNo} AND USER_NO = ${userNo} 
	</select>
	
	<insert id="writeBandBoard" parameterType="hashmap">
		INSERT INTO BAND_BOARD VALUES(BAND_BOARD_SEQ.NEXTVAL, #{title}, #{text}, SYSDATE, 0, 'Y', ${userNo}, 0, 'notag', ${bandNo})
	</insert>
	
	<select id="bandBoardDetail" parameterType="_int" resultMap="bandBoard_rm">
		SELECT BOARD_NO ,BOARD_TITLE, BOARD_CONTENT , CASE WHEN SYSDATE - CREATE_DATE &lt; 1
		THEN TO_CHAR(CREATE_DATE, 'HH:MI')
		ELSE TO_CHAR(CREATE_DATE, 'YYYY-MM-DD')
		END CREATE_DATE, READ_COUNT , USER_NICK, BOARD_LIKE ,BOARD_TAG FROM BAND_BOARD bb 
		JOIN "USER" USING(USER_NO)
		WHERE BOARD_NO = ${boardNo}
	</select>
</mapper>
